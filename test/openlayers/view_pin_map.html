<!DOCTYPE html>
<html>
<head>
    <title>OpenLayers GeoJSON Pin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol/ol.css" type="text/css">
    <style>
        body { margin: 0; padding: 0; }
        #map {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/ol/dist/ol.js"></script>
</head>
<body>
    <div id="map"></div>
    <script>
        // You can replace this with GeoJSON generated by your Python script
        // For example, the output of create_geojson_pin(127.05, 37.55, {"name": "My Spot"})
        const geojsonPinObject = {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [127.05, 37.55] // Default: [Longitude, Latitude]
            },
            "properties": {
                "name": "Sample Pin",
                "description": "This is a sample pin generated for OpenLayers."
            }
        };

        // Create a vector source from the GeoJSON object
        // GeoJSON coordinates are typically EPSG:4326 (lon/lat)
        // The map view is typically EPSG:3857 (Web Mercator)
        const vectorSource = new ol.source.Vector({
            features: new ol.format.GeoJSON().readFeatures(geojsonPinObject, {
                featureProjection: 'EPSG:3857' // Transform from GeoJSON's EPSG:4326 to map's EPSG:3857
            })
        });

        // Create a style for the pin
        const pinStyle = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 8,
                fill: new ol.style.Fill({color: 'rgba(255, 0, 0, 0.7)'}), // Red fill
                stroke: new ol.style.Stroke({color: 'white', width: 2})  // White border
            }),
            text: new ol.style.Text({ // Optional: display a label
                text: geojsonPinObject.properties.name,
                offsetY: -15,
                fill: new ol.style.Fill({color: '#000'}),
                stroke: new ol.style.Stroke({color: '#fff', width: 3})
            })
        });

        // Create a vector layer to display the features
        const vectorLayer = new ol.layer.Vector({
            source: vectorSource,
            style: pinStyle
        });

        // Create the map
        const map = new ol.Map({
            target: 'map', // The ID of the div for the map
            layers: [
                new ol.layer.Tile({ // Base layer (e.g., OpenStreetMap)
                    source: new ol.source.OSM()
                }),
                vectorLayer // Our pin layer
            ],
            view: new ol.View({
                // Center the map on the pin's coordinates
                center: ol.proj.fromLonLat(geojsonPinObject.geometry.coordinates),
                zoom: 15 // Initial zoom level
            })
        });

        // Optional: Add a popup when clicking the pin
        const popupElement = document.createElement('div');
        popupElement.innerHTML = '<p>You clicked here:</p><code></code>';
        popupElement.style.backgroundColor = 'white';
        popupElement.style.padding = '5px';
        popupElement.style.border = '1px solid #ccc';
        popupElement.style.borderRadius = '5px';
        document.body.appendChild(popupElement); // Add to body, will be positioned by OL

        const popup = new ol.Overlay({
            element: popupElement,
            positioning: 'bottom-center',
            stopEvent: false,
            offset: [0, -10]
        });
        map.addOverlay(popup);

        map.on('click', function(evt) {
            const feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                return feature;
            });
            if (feature) {
                const coordinates = feature.getGeometry().getCoordinates(); // These are in EPSG:3857
                popup.setPosition(coordinates);
                const properties = feature.getProperties();
                let content = '<b>' + (properties.name || 'Pin') + '</b>';
                if (properties.description) {
                    content += '<br>' + properties.description;
                }
                popupElement.querySelector('code').innerHTML = content;

                // --- Fire Simulation Placeholder ---
                // Transform coordinates from map projection (EPSG:3857) back to Lon/Lat (EPSG:4326)
                const lonLatCoordinates = ol.proj.toLonLat(coordinates);
                console.log(`Fire simulation initiated at: Longitude ${lonLatCoordinates[0]}, Latitude ${lonLatCoordinates[1]}`);
                // TODO: Replace console.log with actual fire simulation module call
                // Example: startFireSimulation(lonLatCoordinates[0], lonLatCoordinates[1], properties);

            } else {
                popup.setPosition(undefined); // Hide popup
            }
        });

    </script>
</body>
</html>
